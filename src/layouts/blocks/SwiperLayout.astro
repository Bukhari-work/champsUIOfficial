---
export interface Props {
  sliderClass: string;
  swiperOptions: Record<string, any>;
  showGradients?: boolean;
}

const { sliderClass, swiperOptions, showGradients = true } = Astro.props;
---

<section class="relative">
  {
    showGradients && (
      <>
        <div class="from-background pointer-events-none absolute inset-y-0 left-0 z-10 hidden w-1/3 bg-gradient-to-r md:block" />
        <div class="from-background pointer-events-none absolute inset-y-0 right-0 z-10 hidden w-1/3 bg-gradient-to-l md:block" />
      </>
    )
  }
  <div
    class:list={["swiper", sliderClass, "mx-auto overflow-hidden rounded-xl"]}
  >
    <div class="swiper-wrapper">
      <slot />
    </div>

    <!-- Controls -->
    <div class="flex h-20">
      <!-- Pagination -->
      <div
        class:list={[
          `${sliderClass}-pagination`,
          "flex items-center justify-center text-center",
        ]}
      >
      </div>
      <!-- Navigation -->
      <div
        class:list={[
          `${sliderClass}-prev swiper-button-prev flex`,
          "absolute left-1/4 z-10 mx-10 h-11 w-11",
          "bg-primary/10 transform cursor-pointer items-center justify-center rounded-full text-xl select-none hover:bg-black/60 dark:hover:bg-white/60",
        ]}
      >
        &#10094;
      </div>
      <div
        class:list={[
          `${sliderClass}-next swiper-button-next flex`,
          "absolute right-1/4 z-10 mx-10 h-11 w-11",
          "bg-primary/10 transform cursor-pointer items-center justify-center rounded-full text-xl select-none hover:bg-black/60 dark:hover:bg-white/60",
        ]}
      >
        &#10095;
      </div>
    </div>
  </div>
</section>

<script is:inline define:vars={{ sliderClass, swiperOptions }}>
  import { Swiper } from "swiper";
  import "swiper/css";
  import "swiper/css/pagination";
  import "swiper/css/effect-coverflow";
  import { Pagination, EffectCoverflow, Navigation } from "swiper/modules";

  let swiperInstance = null;

  function destroySwiper() {
    if (swiperInstance) {
      swiperInstance.destroy(true, true);
      swiperInstance = null;
    }
  }

  function initSwiper() {
    // Add dynamic pagination and navigation selectors to the options
    const options = {
      ...swiperOptions,
      modules: [Pagination, Navigation, EffectCoverflow],
      pagination: {
        ...swiperOptions.pagination,
        el: `.${sliderClass}-pagination`,
      },
      navigation: {
        ...swiperOptions.navigation,
        nextEl: `.${sliderClass}-next`,
        prevEl: `.${sliderClass}-prev`,
      },
    };
    swiperInstance = new Swiper(`.${sliderClass}`, options);
  }

  document.addEventListener("astro:before-swap", destroySwiper);
  document.addEventListener("astro:page-load", initSwiper);
</script>
